# FASTAPI_TEST_PROGECT

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ—Ä–≥–∞—Ö —Å —Å–∞–π—Ç–∞ —Ç–æ—Ä–≥–æ–≤ —á–µ—Ä–µ–∑ –ø–∞—Ä—Å–µ—Ä –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏—Ö —á–µ—Ä–µ–∑ REST API.

---

## üß± –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:

- **API** ‚Äî FastAPI, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î.
- **Parser** ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø–∞—Ä—Å–µ—Ä, —Å–æ–±–∏—Ä–∞—é—â–∏–π –¥–∞–Ω–Ω—ã–µ —Å —Å–∞–π—Ç–∞ –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—â–∏–π –∏—Ö –≤ –ë–î.
- **PostgreSQL** ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö.
- **Redis** ‚Äî –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤.

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
spimex-trading-api/
‚îÇ
‚îú‚îÄ‚îÄ src/                       # –û–±—â–∞—è –∫–æ–¥–æ–≤–∞—è –±–∞–∑–∞
‚îÇ ‚îú‚îÄ‚îÄ api_service/             # FastAPI —Å–µ—Ä–≤–∏—Å
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ main.py                # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ routers/trading.py     # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ models.py              # ORM-–º–æ–¥–µ–ª–∏
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ schemas.py             # Pydantic-—Å—Ö–µ–º—ã
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ database.py            # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ redis_cache.py         # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Redis
‚îÇ ‚îî‚îÄ‚îÄ parser_service/          # –ü–∞—Ä—Å–µ—Ä
‚îÇ ‚îú‚îÄ‚îÄ parser.py                # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞
‚îÇ ‚îú‚îÄ‚îÄ models.py                # ORM-–º–æ–¥–µ–ª–∏ (–æ–±—â–∏–µ —Å API)
‚îÇ ‚îî‚îÄ‚îÄ database.py              # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îÇ
‚îú‚îÄ‚îÄ requirements/              # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îÇ ‚îú‚îÄ‚îÄ api.txt                  # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ API
‚îÇ ‚îî‚îÄ‚îÄ parser.txt               # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–∞—Ä—Å–µ—Ä–∞
‚îÇ
‚îú‚îÄ‚îÄ api_service/               # –°–±–æ—Ä–∫–∞ API
‚îÇ ‚îî‚îÄ‚îÄ Dockerfile
‚îÇ
‚îú‚îÄ‚îÄ parser_service/            # –°–±–æ—Ä–∫–∞ –ø–∞—Ä—Å–µ—Ä–∞
‚îÇ ‚îî‚îÄ‚îÄ Dockerfile
‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ api/                     # –¢–µ—Å—Ç—ã API
‚îÇ ‚îú‚îÄ‚îÄ parser/                  # –¢–µ—Å—Ç—ã –ø–∞—Ä—Å–µ—Ä–∞
‚îÇ ‚îî‚îÄ‚îÄ conftest.py              # –û–±—â–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ tests/                     # –¢–µ—Å—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ pyproject.toml             # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç–∞ (src/)
‚îú‚îÄ‚îÄ docker-compose.yml         # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
‚îú‚îÄ‚îÄ .gitignore                 # –ò—Å–∫–ª—é—á—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îî‚îÄ‚îÄ README.md                  # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
   ```bash
   git clone https://github.com/MrTimofeev/FastAPI_Test_Progect.git
   cd FastAPI_Test_Progect
   ```

2. –£—Å—Ç–∞–Ω–æ–≤–∏ Docker –∏ Docker Compose:
   - [Docker](https://docs.docker.com/get-docker/)
   - [Docker Compose](https://docs.docker.com/compose/install/)

3. –°–æ–±–µ—Ä–∏ –∏ –∑–∞–ø—É—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç:
   ```bash
   docker-compose up -d --build
   ```

4. –û—Ç–∫—Ä–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API:
   ```
   http://localhost:8000/docs
   ```

---

## üïπÔ∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. API

API –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:  
üëâ `http://localhost:8000/trading/...`

#### GET `/trading/last_dates`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–∞—Ç.

–ü—Ä–∏–º–µ—Ä:
```
GET /trading/last_dates?n=5
```

#### GET `/trading/dynamics`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∑–∞ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏.

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `oil_id` ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –Ω–µ—Ñ—Ç–∏
- `delivery_type_id` ‚Äî —Ç–∏–ø –ø–æ—Å—Ç–∞–≤–∫–∏
- `delivery_basis_id` ‚Äî –±–∞–∑–∏—Å –ø–æ—Å—Ç–∞–≤–∫–∏
- `start_date` ‚Äî –Ω–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞
- `end_date` ‚Äî –∫–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞

–ü—Ä–∏–º–µ—Ä:
```
GET /trading/dynamics?oil_id=A592&start_date=2024-01-01
```

#### GET `/trading/results`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–∞–º—ã–µ —Å–≤–µ–∂–∏–µ —Ç–æ—Ä–≥–∏.

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `oil_id` ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –Ω–µ—Ñ—Ç–∏
- `delivery_type_id` ‚Äî —Ç–∏–ø –ø–æ—Å—Ç–∞–≤–∫–∏
- `delivery_basis_id` ‚Äî –±–∞–∑–∏—Å –ø–æ—Å—Ç–∞–≤–∫–∏

–ü—Ä–∏–º–µ—Ä:
```
GET /trading/results?oil_id=A592
```

--- 
## üóÇÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è `.env` —Ñ–∞–π–ª—ã –≤ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–∏—Å–µ.

`.env` –¥–ª—è `api-service` –∏ `parser-service`:
```env
DATABASE_URL=postgresql+asyncpg://user:password@postgres/spimex_db
```
---

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å –ë–î

–ü–æ–¥–∫–ª—é—á–∏—Å—å –∫ PostgreSQL:
```bash
docker exec -it spimex-trading-api-postgres-1 psql -U user -d spimex_db
```

–í—ã–ø–æ–ª–Ω–∏ SQL-–∑–∞–ø—Ä–æ—Å:
```sql
SELECT * FROM parsed_data LIMIT 10;
```
